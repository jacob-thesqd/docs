---
title: "MMQ (Webhook - GET)"
description: "This API endpoint handles incoming GET requests via a webhook for the MMQ system. It initiates a process that checks account capacity, retrieves task-specific data from Postgres, and responds accordingly, enabling real-time interactions for task management and updates."
api: "GET /mmq"
---

## Workflow Overview

This workflow is triggered by an incoming HTTP GET request to the `/mmq` webhook endpoint. It checks if an account has room for additional tasks, retrieves relevant task and account data from Postgres, processes and updates task statuses, and responds with appropriate data, facilitating real-time task management and updates within the MMQ system.

---

## Request Example

<RequestExample>

```bash
curl --request GET \
  --url https://sisx.thesqd.com/webhook/mmq
```

</RequestExample>

---

## Nodes

### Webhook
The webhook node that triggers the workflow on GET or PATCH requests to `/mmq`. It listens for incoming requests and initiates the process.

- **Parameters:**
  - `path`: "mmq"
  - `httpMethod`: ["GET", "PATCH"]
  - `responseMode`: "responseNode"
  - `multipleMethods`: true
- **Function:** Waits for incoming GET/ PATCH requests on `/mmq` and passes the data downstream.

---

### Switch2
Splits the flow based on the presence of `query.id` and `query.account` parameters.

- **Rules:**
  - If `query.id` exists and `query.account` does not, proceed with one branch.
  - If `query.account` exists and `query.id` does not, proceed with another branch.
- **Function:** Conditional routing based on provided query parameters.

---

### Get Account1
Sets the account number from the query parameter for downstream use.

- **Parameters:**
  - `value`: `{{ $json.query.account }}`
- **Function:** Extracts account ID from the query string for use in subsequent database queries.

---

### Postgres: Check if account has room
Queries the account details and current task load to assess if new tasks can be added.

- **Parameters:**
  - Query: `SELECT * FROM get_account_task_stats({{ $json.account }}) JOIN accounts a ON a.account = {{ $json.account }}`
- **Function:** Checks current usage, capacity, and other related account info. Continues regardless of capacity status.

---

### Switch4
Routes based on the account's capacity/status information for the subsequent task handling.

- **Function:** Determines whether to proceed with task processing based on account capacity.

---

### Edit Fields12
Prepares task data for updating, assigns task-related info, including status and due date.

- **Parameters:**
  - Sets `task_id`, `status`, `active`, and `due_date` from previous data.

---

### Postgres13
Updates task information including status, due date, and activity state.

- **Parameters:**
  - Query: `UPDATE public.tasks SET ... WHERE task_id = {{ $json.task_id }}`
- **Function:** Updates task status, activity, and due date in the database.

---

### Webhook (play/pause)
Receives PATCH requests for play/pause actions related to tasks.

- **Parameters:**
  - `path`: "play-pause"
  - `httpMethod`: "PATCH"
  - Responds with a simple JSON indicating acknowledgment.

---

### Switch5
Routes actions based on the `action` value, e.g., "pause" or "play".

- **Function:** Determines whether to pause or play a task based on action keyword.

---

### Edit Fields9
Sets fields for pausing tasks: task ID, status as "on hold", and active flag.

- **Parameters:**
  - Assigns `task_id`, `status`, and `active` from incoming request data.

---

### ClickUp
Updates the task status on ClickUp to "on hold" (pause operation).

- **Parameters:**
  - `id`: `{{ $json.task_id }}`
  - `operation`: "update"
  - `updateFields`: `{"status":"on hold"}`

- **Credentials:**
  - `clickUpApi`: "TheSquad"

---

### Postgres15
Logs the pause action into the database, capturing task ID, account, and data.

- **Query:** `INSERT INTO public.mmq_log (data, action, account) VALUES (...)`

---

### Respond to Webhook2
Responds with a simple confirmation of the pause operation execution.

- **Response Body:** "{}"

---

### Merge1
Combines data streams from previous steps, preparing for further processing or final response.

---

### Webhook3
Handles incoming POST requests to trigger resume or other task actions.

- **Parameters:**
  - `path`: "logo"
  - `httpMethod`: "PATCH"

---

### Postgres16
Executes a SQL command to refresh materialized views related to active projects.

- **Query:** `REFRESH MATERIALIZED VIEW active_projects_mv;`

---

### Webhook4
Receives requests for resume or other task actions and continues the flow.

---

### ClickUp4
Reverts task status back to previous state (e.g., "active").

- **Parameters:**
  - `id`: `{{ $json.task_id }}`
  - `operation`: "update"
  - `updateFields`: `{"status":"active"}`

- **Credentials:**
  - `clickUpApi`: "TheSquad"

---

### Postgres17
Runs a complex SQL query to gather detailed task info, update statuses, deadlines, and record history, then logs or updates accordingly.

---

### Webhook6
Upon task status change, updates the system and sends back a JSON response indicating success.

---

### Additional Nodes
Further nodes manage additional data processing, updating logs, handling different task states, and final responses, as the process continues navigation through the system.

---

## Execution Data (Sample Post-Execution Responses)

- Contains the latest state of each node after execution.
- Includes mock data from the system, representing task details, account info, timestamps, and activity status.
- Example: For the `Check if account has room` node, it confirms current usage, capacity, and additional info like church details, contact info, and task statuses.

---

*This document serves as a comprehensive guide to the `/mmq` GET endpoint, detailing each node's function, parameters, and flow logic for full understanding of the webhook system's operations.*