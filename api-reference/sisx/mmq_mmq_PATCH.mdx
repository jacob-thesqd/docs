---
title: "MMQ (Webhook - PATCH)"
description: "This API documentation details how the MMQ workflow is triggered via a Webhook with PATCH method, and describes the sequence of nodes handling the request, interacting with Postgres databases, and updating tasks in ClickUp based on the received data."
api: "PATCH /mmq"
---

<Card title="Link card" icon="link" href="https://sisx.thesqd.com/workflow/E10tRBL43E5QZ3we" arrow="true" cta="Click here">
  MMQ
</Card>

<RequestExample>

```bash Request
curl --request POST \
  --url https://sisx.thesqd.com/webhook/mmq
```

</RequestExample>

# Workflow Overview
This workflow listens for PATCH requests on the `/mmq` endpoint, processes task and account data from the database, and updates task statuses in ClickUp accordingly. It also manages task dependencies, handles Webhook responses, and logs all interactions in the database.

## Webhook Trigger
### Webhook (n8n-nodes-base.webhook)
Listens for PATCH/GET requests on path `mmq` with response mode set to `responseNode`. Activates upon receiving a PATCH request, initiating the sequence of nodes.

Parameters:
- Path: `"mmq"`  
- Multiple Methods: `[ "GET", "PATCH" ]`  
- Response Mode: `"responseNode"`  
- Response Behavior: Responds with a node specified in `Respond to Webhook` nodes.

---

## Nodes Sequence

### Webhook (n8n-nodes-base.webhook)
Receives incoming PATCH or GET request at `/mmq`, triggers subsequent nodes.

### Switch2 (n8n-nodes-base.switch)
Based on the query parameters, routes to either `Check if account has room` or proceeds to other nodes for task processing.

Parameters:
- Rules:
  1. If `query.id` exists and `query.account` does not, route to `Check if account has room`.
  2. Else, proceed to process account data.

### Check if account has room (Postgres query)
Verifies if the account associated with the task has capacity for additional tasks.
Query:
`SELECT * FROM get_account_task_stats({{ $json.account }}) JOIN accounts a ON a.account = {{ $json.account }}`

Retrieves:
- `cap`: max task capacity
- `room`: remaining capacity
- `active_tasks`: number of active tasks
- Additional account info and contact data.

### Respond to Webhook (n8n-nodes-base.respondToWebhook)
Sends JSON response `{"tasks_found": false}` if no relevant task data is provided or after processing.

### Get Account1 (Postgres query)
Fetches account info such as `account`, `active_tasks`, and related details for further processing.

### Main Data Processing

#### Node: Postgres7
Uses complex SQL with multiple CTEs to retrieve detailed task data, such as status, assignee, tags, due date, and project information, based on `account`.

#### Node: Filter
Filters out tasks with specific tags or statuses that should not be processed further, ensuring only relevant tasks are handled.

#### Node: Merge2
Combines task data from previous nodes for unified processing.

#### Node: Edit Fields5
Sets `cap` (capacity) and various task lists including active tasks, scheduled dates, and other metadata into the data payload.

#### Node: Webhook5
Responds with the current task data, providing structured task info back to the requester.

#### Node: Postgres12
Fetches detailed task info, including recent status changes, due dates, assigned users, and time tracking.

#### Node: Postgres13
Updates task logs with new data such as queue position, status, and timestamps.

#### Node: ClickUp1
Reverts task status in ClickUp to previous state (`status_before`).

### Additional Task Action Nodes
Involves updating task statuses, handling pausing/playing, reordering, and modifying task details based on the logic determined from previous steps. Nodes like `Switch4`, `Switch5`, and others route tasks based on the desired action (`pause`, `play`, or order changes).

### Webhook3 (Handling Play/Pause)
Receives PATCH requests at `/play-pause`, processes the action command (`pause` or `play`), and updates the task in ClickUp accordingly.

### Webhook4, Webhook8, Webhook9
Respond to specific Webhook calls with appropriate JSON, binary, or no content responses to confirm actions were completed.

### Database Logging
Nodes like `Postgres14`, `Postgres15`, `Postgres16`, and `Postgres17` handle logging, refresh materialized views, or update task statuses in the database to reflect current state.

### Additional Task Management
Nodes such as `Switch4`, `Switch5`, and `Filter` nodes route tasks based on their current status and trigger updates, reordering, or pausing/playing tasks in ClickUp.

---

## Summary
This workflow automates handling of task updates via PATCH requests on `/mmq`. It checks account capacities, updates task statuses in ClickUp, logs changes in Postgres, and manages task sequencing (ordering, pausing, resuming). It ensures that task state in the project management system reflects the latest information received through the webhook.

---